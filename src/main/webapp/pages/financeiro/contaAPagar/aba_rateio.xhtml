<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">

	<style>
<!--
.rotulo {
	width: 190xp !important;
}
-->
</style>

	<p:panel styleClass="semPreenchimento" id="panel-rateio">

		<h:form prependId="false" id="frm-rateio">

			<p:toolbar styleClass="semPreenchimento">
				<p:toolbarGroup>
					<p:commandButton id="addRateio" value="Adicionar"
						style="margin-bottom:10px;" icon="ui-icon-plus"
						action="#{contaAPagarBean.iniciarLancRateio}"
						oncomplete="PF('dialogCadRateio').show()" process="@this" />
				</p:toolbarGroup>
				<p:toolbarGroup align="right">
					<p:outputLabel value="Total"
						style="font-size:13px; margin-right:10px; color:black" />
					<p:outputLabel id="txtTotalRateio"
						style="color:red; font-size:13px; margin-right:10px;"
						value="#{contaAPagarBean.totalRateio}">
						<f:convertNumber type="currency" />
					</p:outputLabel>
				</p:toolbarGroup>
			</p:toolbar>

			<p:dataTable id="tblRateioDes" style="width:99%;"
				emptyMessage="Nenhuma registro lançado" scrollable="true"
				scrollHeight="175"
				value="#{contaAPagarBean.contaAPagar.movimentacoes}" var="m">

				<p:column style="width:170px" headerText="Conta">
					<h:outputText value="#{m.planoConta.nome}" />
				</p:column>

				<p:column style="width:230px" headerText="Descrição">
					<h:outputText value="#{m.descricao}" />
				</p:column>

				<p:column style="width:88px" headerText="Valor">
					<h:outputText value="#{m.vlrSaida}">
						<f:convertNumber type="currency" />
					</h:outputText>
				</p:column>

				<p:column style="text-align:center;width:50px" headerText="Ação">
					<p:commandButton title="Excluir" process="@this"
						icon="ui-icon-trash" styleClass="semPreenchimento"
						update="tblRateioDes txtTotalRateio :frm-cadastro:txtEmissao"
						action="#{contaAPagarBean.removerConta()}">
						<f:setPropertyActionListener value="#{m}"
							target="#{contaAPagarBean.movto}" />
					</p:commandButton>
				</p:column>

			</p:dataTable>

			<p:confirmDialog header="Confirmação de Exclusão"
				widgetVar="confirmacaoExclusaoRateio"
				id="confirmacaoExclusaoDialogRateio">
				<f:facet name="message">
					<h:outputText value="Tem certeza que deseja excluir o registro:" />
					<br />
					<h:outputText value="#{contaAPagarBean.cPSelecionado.descricao} ?" />
				</f:facet>
				<p:button value="Não"
					onclick="PF('confirmacaoExclusaoRateio').hide(); return false;" />
				<p:commandButton value="Sim"
					oncomplete="PF('confirmacaoExclusaoRateio').hide();"
					update="tblRateioDes" action="#{contaAPagarBean.removerConta()}"
					process="@this" />
			</p:confirmDialog>

		</h:form>

	</p:panel>

	<p:dialog header="Lançamento de Rateio" widgetVar="dialogCadRateio"
		modal="true" resizable="false" draggable="true" id="dgCadRateio"
		closeOnEscape="true" width="460" height="245" appendTo="@(body)">

		<p:ajax event="close" update=":frm-cadastro:txtEmissao" />

		<h:form id="frm-cadastro-rateio" prependId="false">

			<p:growl autoUpdate="true" />

			<h:panelGrid id="panelCadastroRateio" columns="2"
				style="margin-top:10px;" columnClasses="rotulo">


				<p:outputLabel for="txtTipo" value="Tipo" />
				<p:selectOneMenu id="txtTipo" autoWidth="false" style="width:50%;"
					value="#{contaAPagarBean.cPSelecionado.tipoConta}"
					disabled="#{movimentacaoBean.movto.notInclusao}"
					converter="omnifaces.SelectItemsConverter" required="true"
					requiredMessage="Selecione tipo">
					<f:selectItem itemLabel="Selecione..." itemValue="#{null}" />
					<f:selectItems value="#{contaAPagarBean.listaTipoContas}"
						var="tipo" itemLabel="#{tipo.sigla} - #{tipo.descricao}"
						itemValue="#{tipo}" />
					<p:ajax event="change" process="@this"
						listener="#{contaAPagarBean.carregarContasLanctos}"
						update="combConta" />
				</p:selectOneMenu>

				<p:outputLabel for="combConta" value="Conta" />
				<p:selectOneMenu id="combConta" required="true" autoWidth="false"
					filter="true" filterMatchMode="contains" style="width:91%;"
					converter="omnifaces.SelectItemsConverter"
					value="#{contaAPagarBean.movto.planoConta}"
					requiredMessage="Selecione conta">
					<f:selectItem itemLabel="Selecione..." itemValue="#{null}" />
					<f:selectItems value="#{contaAPagarBean.listaContas}" var="conta"
						itemLabel="#{conta.nome}" itemValue="#{conta}" />
				</p:selectOneMenu>

				<p:outputLabel for="txtDescricao" value="Descrição" />
				<p:inputText id="txtDescricao"
					value="#{contaAPagarBean.movto.descricao}" size="36" />

				<p:outputLabel for="combFavorecido" value="Favorecido" />
				<p:selectOneMenu id="combFavorecido" autoWidth="false" filter="true"
					value="#{contaAPagarBean.movto.pessoa}" filterMatchMode="contains"
					style="width:91%;" converter="omnifaces.SelectItemsConverter">
					<f:selectItem itemLabel="Selecione..." itemValue="#{null}" />
					<f:selectItems value="#{contaAPagarBean.carregarFornecedores}"
						var="p" itemLabel="#{p.nome}" itemValue="#{p}" />
				</p:selectOneMenu>


				<p:outputLabel value="Documento" />
				<p:inputText size="10" value="#{contaAPagarBean.movto.documento}" />

				<p:outputLabel for="txtValor" value="Valor" />
				<p:inputText id="txtValor" required="true"
					requiredMessage="Informe um valor"
					onfocus="formatoMoeda('txtValor')"
					value="#{contaAPagarBean.movto.vlrSaida}" size="10">
					<f:validateDoubleRange minimum="0.01" />
					<f:convertNumber type="currency" />
				</p:inputText>

			</h:panelGrid>

			<p:toolbar style="margin-top: 15px" styleClass="semPreenchimento">
				<p:toolbarGroup align="right" style="margin-right: 0px;">
					<p:commandButton value="Salvar" icon="fa fa-save"
						process="@this frm-cadastro-rateio"
						action="#{contaAPagarBean.addConta()}"
						update="frm-cadastro-rateio tblRateioDes txtEmissao txtTotalRateio"
						id="salvarCommandButtonRateio">
					</p:commandButton>
				</p:toolbarGroup>
			</p:toolbar>

			<p:defaultCommand target="salvarCommandButtonRateio" />

		</h:form>

	</p:dialog>

</ui:composition>